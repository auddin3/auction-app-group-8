import{_,c as r,a as t,t as a,w as h,v as p,F as u,r as f,b as g,o as c}from"./index.18052401.js";const w={props:["pid"],data(){return{comments:[],loggedUsername:"",loggedUserFullName:"",loggedUserId:0,newComment:"",product_name:"",description:"",start_price:0,owner:"",endOfBid:"",noOfSecsLeft:5,endOfBidFormatted:"",period:0,imgpath:"/media/product-images/stock-image.png",bid_entry:0,bid_total:0,win_price:0,user_id:0,user_email:""}},computed:{filteredComments(){return JSON.parse(JSON.stringify(this.comments))}},methods:{async getLoggedInUser(){try{let e=await fetch("http://localhost:8000/auctionapp/user",{credentials:"include",mode:"cors",referrerPolicy:"no-referrer",method:"GET"});const n=(await e.json()).user_id;this.loggedUserId=n,e=await fetch("http://localhost:8000/auctionapp/api/profile/"+n);let i=(await e.json()).user;this.loggedUsername=i.username,this.loggedUserFullName=i.fname+" "+i.lname}catch{window.location.href="http://localhost:8000/auctionapp"}},async getItemComments(){try{const n=(await(await fetch("http://localhost:8000/auctionapp/api/comments/"+this.pid)).json()).comments,d=JSON.parse(JSON.stringify(n));this.comments=d}catch(e){alert(e)}},async addComment(){await fetch("http://localhost:8000/auctionapp/api/comments/"+this.pid,{method:"POST",body:JSON.stringify({question:this.newComment,sender:this.loggedUserId,answer:""})}).then(e=>{this.getItemComments(),this.newComment=""}).catch(e=>{alert(e)})},async replyComment(e){await fetch("http://localhost:8000/auctionapp/api/comments/"+this.pid,{method:"PUT",body:JSON.stringify({answer:e.answer,recipient:this.loggedUserId,question:e.question})}).then(s=>{this.getItemComments()}).catch(s=>{alert(s)})},async getProductData(){let n=(await(await fetch("http://localhost:8000/auctionapp/api/items/"+this.pid)).json()).product;this.product_name=n.product_name,this.description=n.description,this.start_price=n.start_price,this.owner=n.owner,this.endOfBid=n.end_of_bid,this.imgpath=n.product_image;var d=new Date,i=new Date(this.endOfBid);this.noOfSecsLeft=(i.valueOf()-d.valueOf())/1e3,console.log("no of secs left ",this.noOfSecsLeft,"s")},async getBidCount(){let s=await(await fetch("http://localhost:8000/auctionapp/api/bidCount/"+this.pid)).json();this.bid_total=s.total,this.win_price=s.win,s.win==0?this.bid_entry=this.start_price:this.bid_entry=s.win},async addBid(){await fetch("http://localhost:8000/auctionapp/api/bids/"+this.pid,{method:"POST",body:JSON.stringify({bidder:this.loggedUserId,bid_price:this.bid_entry})}).then(e=>{this.bid_entry=this.start_price,this.getBidCount()}).catch(e=>{alert(e)})},async formatTime(){if(await this.getProductData(),console.log("secondss",this.noOfSecsLeft),this.noOfSecsLeft>0){let e=this.noOfSecsLeft,s=Math.floor(e/(24*3600));e=e%(24*3600);let n=Math.floor(e/3600);e=e%3600;let d=Math.floor(e/60);e=e%60;let i=Math.floor(e);this.endOfBidFormatted=s+" Days "+n+" Hours "+d+" Minutes "+i+" Seconds";return}else{this.endOfBidFormatted="0 Days 0 Hours 0 Minutes 0 Seconds",this.deleteProduct();return}},async getWinner(){let s=await(await fetch("http://localhost:8000/auctionapp/api/getWinner/"+this.pid)).json();this.user_id=s.user_id,this.user_email=s.user_email,console.log("email",this.user_email,this.user_id)},async emailWinner(){await this.getWinner();let s=await(await fetch("http://localhost:8000/auctionapp/api/emailWinner/"+this.user_id+"/"+this.pid)).json();console.log("email sent to",s.useremail)},async deleteProduct(){await this.getWinner(),await this.emailWinner(),await fetch("http://localhost:8000/auctionapp/api/deleteProduct/"+this.pid,{method:"DELETE"}),await this.viewSearch()},async viewSearch(){try{this.$router.push({name:"Auctions",path:"",params:{}})}catch(e){console.log(e)}}},async mounted(){this.getItemComments(),this.getLoggedInUser(),this.getProductData(),this.getBidCount(),this.formatTime()}};const y={class:"card item-page-container row g-0"},v={class:"d-flex"},b={class:"card mt-4 border: 1px solid #e0e0e0",style:{width:"40rem"}},x=["src"],C={class:"card mt-4 border: 1px solid #e0e0e0",style:{width:"60rem"}},O={class:"card-body"},S={class:"card-title"},B={class:"card-text"},U={class:"card-text price-colour"},I={class:"card-text"},D={class:"card-text"},k={class:"row g-0 bid-container p-4"},j={class:"col-sm-6"},N={class:"row g-1"},P=t("h5",{class:"col-sm-5 text-pink"},"Best offer: ",-1),q=t("div",{class:"col-sm-1"},null,-1),L={class:"col-sm-6 d-flex flex-column align-items-start"},T={class:"text-muted"},F={class:"col-sm-6 d-flex flex-column align-items-end"},E={class:"text-muted"},J={class:"m-t-40"},M=t("div",null,[t("h5",{class:"question-header"},"Comments")],-1),W={key:0},A={class:"card-group"},V={class:"card mt-4 rounded",style:{width:"60rem"}},H={class:"card-body"},R={class:"d-flex justify-start"},G={class:"card-title username"},z={class:"text-muted"},K={class:"card-text question-text"},Q={key:0},X={class:"card-text question-reply"},Y=["onUpdate:modelValue"],Z={class:"d-flex flex-row-reverse"},$=["onClick"],tt={key:1,class:"p-r-4"},et={class:"d-flex justify-start question-reply"},st={class:"card-title username"},it={class:"text-muted"},ot={class:"d-flex justify start"},at={class:"card-text question-text"},nt={class:"card-group"},dt={class:"card mt-4 bg-light",style:{width:"60rem"}},rt={class:"d-flex justify-start"},ct=t("small",{class:"text-muted"}," Comment as ",-1),lt={class:"card-title username"},ht={class:"card-text question-reply"},pt={class:"d-flex flex-row-reverse"};function mt(e,s,n,d,i,l){return c(),r("div",y,[t("div",v,[t("div",b,[t("img",{class:"card-img-top product-image",src:`http://localhost:8000${i.imgpath}`,alt:"Item image"},null,8,x)]),t("div",C,[t("div",O,[t("h4",S,a(i.product_name),1),t("p",B,a(i.description),1),t("p",U,[t("strong",null,"Start Price: \xA3"+a(i.start_price),1)]),t("p",I,"End of Bid: "+a(i.endOfBidFormatted),1),t("p",D,"Owner: "+a(i.owner),1)])])]),t("div",k,[t("div",j,[t("div",N,[P,q,t("div",L,[t("h3",null,"\xA3"+a(i.win_price),1),h(t("input",{type:"number",placeholder:"Bid amount",class:"bid-input p-2","onUpdate:modelValue":s[0]||(s[0]=o=>i.bid_entry=o),step:"0.01"},null,512),[[p,i.bid_entry]]),t("small",T,"Enter \xA3"+a(i.start_price)+" or more",1)])])]),t("div",F,[t("small",E,"["+a(i.bid_total)+" bids]",1),t("button",{class:"btn btn-primary bid-btn",onClick:s[1]||(s[1]=(...o)=>l.addBid&&l.addBid(...o)),min:"{{ start_price }}"},"Submit Bid")])]),t("div",J,[M,i.comments.length>0?(c(),r("div",W,[(c(!0),r(u,null,f(l.filteredComments,o=>(c(),r("div",null,[t("div",A,[t("div",V,[t("div",H,[t("div",R,[t("h4",G,a(o.sender),1),t("small",z," asked about "+a(o.product.slice(0,55)),1)]),t("div",null,[t("p",K,a(o.question),1)]),o.answer.length<1?(c(),r("div",Q,[t("div",X,[h(t("input",{type:"text","onUpdate:modelValue":m=>o.answer=m,placeholder:"Reply",class:"w-full rounded p-2"},null,8,Y),[[p,o.answer]])]),t("div",Z,[t("button",{class:"btn btn-primary comment-btn",onClick:m=>l.replyComment(o)},"Reply",8,$)])])):(c(),r("div",tt,[t("div",et,[t("h4",st,a(o.recipient),1),t("small",it," replied to "+a(o.sender),1)]),t("div",ot,[t("p",at,a(o.answer),1)])]))])])])]))),256))])):g("",!0),t("div",nt,[t("div",dt,[t("div",rt,[ct,t("h4",lt,"\xA0 "+a(i.loggedUsername),1)]),t("div",ht,[h(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=o=>i.newComment=o),type:"text",placeholder:"Add a comment...",class:"w-full rounded p-3",rows:"5"},null,512),[[p,i.newComment]])]),t("div",pt,[t("button",{class:"btn btn-primary comment-btn",onClick:s[3]||(s[3]=o=>l.addComment())},"Comment")])])])])])}const ut=_(w,[["render",mt]]);export{ut as default};
